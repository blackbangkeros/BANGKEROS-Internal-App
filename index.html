<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital BANGKEROS - Centralized Monitoring App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* Slate 100 */
        }
        .status-dot {
            height: 10px;
            width: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .nav-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            color: #4b5563; /* Gray-600 */
            border-radius: 0.5rem;
            transition: all 0.2s ease-in-out;
            font-weight: 500;
        }
        .nav-link:hover {
            background-color: #f3f4f6; /* Gray-100 */
            color: #1f2937; /* Gray-800 */
        }
        .nav-link.active {
            background-color: #ecfdf5; /* Emerald-50 */
            color: #065f46; /* Emerald-800 */
            font-weight: 600;
        }
        .nav-link svg {
            margin-right: 0.75rem;
        }
    </style>
</head>
<body class="antialiased text-gray-800">

    <div class="min-h-screen flex">
        <!-- Sidebar -->
        <aside class="w-64 bg-white shadow-lg flex-shrink-0">
            <div class="h-full flex flex-col">
                <div class="h-20 flex items-center justify-center border-b-2 border-gray-100">
                    <img src="https://raw.githubusercontent.com/js-fan/logo-hosting/main/bangkeros_seal.png" alt="BANGKEROS Logo" class="h-14" onerror="this.onerror=null;this.src='https://placehold.co/150x50/ffffff/059669?text=BANGKEROS';">
                </div>
                <nav class="flex-1 p-4 space-y-2">
                    <a href="#dashboard" class="nav-link active">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                        Dashboard
                    </a>
                    <a href="#lts" class="nav-link">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
                        LTS
                    </a>
                    <a href="#compliance" class="nav-link">
                       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        Compliance
                    </a>
                     <a href="#financials" class="nav-link">
                       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"></path></svg>
                        Financials
                    </a>
                </nav>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-6 md:p-10 overflow-y-auto">
            <header class="mb-8" id="dashboard">
                <h1 class="text-3xl font-bold text-gray-800">Centralized Monitoring Dashboard</h1>
                <p class="text-gray-600 mt-1">Real-time overview of cooperative operations. Last updated: <span id="last-updated"></span></p>
            </header>

            <!-- Key Metrics -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white p-6 rounded-lg shadow-sm">
                    <h3 class="text-sm font-medium text-gray-500">Active Projects (LTS)</h3>
                    <p class="text-3xl font-bold text-emerald-600" id="active-projects-count">0</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-sm">
                    <h3 class="text-sm font-medium text-gray-500">Compliance Alerts</h3>
                    <p class="text-3xl font-bold text-red-600" id="compliance-alerts-count">0</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-sm">
                    <h3 class="text-sm font-medium text-gray-500">Guest Satisfaction</h3>
                    <p class="text-3xl font-bold text-blue-600" id="guest-satisfaction-score">9.0/9</p>
                </div>
                 <div class="bg-white p-6 rounded-lg shadow-sm">
                    <h3 class="text-sm font-medium text-gray-500">Last Surprise Cash Count</h3>
                    <p class="text-3xl font-bold text-gray-700" id="last-cash-count-date">N/A</p>
                </div>
            </div>

            <!-- NEW: Dashboard Row for CDC, Expenses, and Events -->
            <div class="grid grid-cols-1 xl:grid-cols-3 gap-8 mb-8">
                <!-- Top CDC Contributors -->
                <div class="bg-white p-6 rounded-lg shadow-sm xl:col-span-1">
                    <h2 class="text-xl font-bold mb-4">Top CDC Contributors</h2>
                    <ul class="space-y-4" id="top-contributors-list">
                        <!-- JS will populate this -->
                    </ul>
                </div>
                <!-- Latest Expenses & Upcoming Events -->
                <div class="xl:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow-sm">
                        <h2 class="text-xl font-bold mb-4">Latest Expenses</h2>
                        <ul class="space-y-4" id="latest-expenses-list">
                            <!-- JS will populate this -->
                        </ul>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-sm">
                        <h2 class="text-xl font-bold mb-4">Upcoming Events</h2>
                        <ul class="space-y-4" id="upcoming-events-list">
                           <!-- JS will populate this -->
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Luntian Tracking System (LTS) -->
            <section class="bg-white p-6 rounded-lg shadow-sm mb-8" id="lts">
                <h2 class="text-xl font-bold mb-4">Luntian Tracking System (LTS)</h2>
                <div class="mb-4">
                    <input type="text" id="lts-search" placeholder="Search projects..." class="w-full md:w-1/3 px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500">
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="bg-gray-50 text-xs text-gray-700 uppercase">
                            <tr>
                                <th class="px-6 py-3">Project / Concern</th>
                                <th class="px-6 py-3">Person-in-Charge (PIC)</th>
                                <th class="px-6 py-3">Status</th>
                                <th class="px-6 py-3">Last Update</th>
                            </tr>
                        </thead>
                        <tbody id="lts-table-body">
                            <!-- JS will populate this -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Regulatory Compliance Tracker -->
            <section class="bg-white p-6 rounded-lg shadow-sm mb-8" id="compliance">
                <h2 class="text-xl font-bold mb-4">MARINA Regulatory Compliance Tracker</h2>
                 <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="bg-gray-50 text-xs text-gray-700 uppercase">
                            <tr>
                                <th class="px-6 py-3">Vessel Name</th>
                                <th class="px-6 py-3">Certificate</th>
                                <th class="px-6 py-3">Expiry Date</th>
                                <th class="px-6 py-3">Status</th>
                            </tr>
                        </thead>
                        <tbody id="compliance-table-body">
                            <!-- JS will populate this -->
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- Financials and Performance -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <section class="bg-white p-6 rounded-lg shadow-sm" id="financials">
                     <h2 class="text-xl font-bold mb-4">Monthly Financial Snapshot</h2>
                     <canvas id="financials-chart"></canvas>
                </section>
                 <section class="bg-white p-6 rounded-lg shadow-sm">
                     <h2 class="text-xl font-bold mb-4">Internal Audit Log</h2>
                     <ul class="space-y-4" id="audit-log">
                        <!-- JS will populate -->
                     </ul>
                </section>
            </div>

        </main>
    </div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    // --- MOCK DATA ---
    // In a real application, this data would come from a database like Firebase.
    const mockData = {
        ltsProjects: [
            { id: 'LTS-001', title: 'Luntian Genesis Reef - Pilot', pic: 'Luntian Committee', status: 'On Track', lastUpdate: '2025-07-03' },
            { id: 'LTS-002', title: 'Aquaculture Farm Setup', pic: 'Fishermen Sector', status: 'On Track', lastUpdate: '2025-07-01' },
            { id: 'LTS-003', title: 'Request for LGU Meeting', pic: 'Board Secretary', status: 'Completed', lastUpdate: '2025-06-28' },
            { id: 'LTS-004', title: 'Q3 Training Plan (ATEP)', pic: 'Education Committee', status: 'Planning', lastUpdate: '2025-06-30' },
            { id: 'LTS-005', title: 'Maiden Marshals Uniforms', pic: 'GAD Committee', status: 'Delayed', lastUpdate: '2025-06-25' },
        ],
        compliance: [
            { vessel: 'MBCA Luntian I', certificate: 'Certificate of Public Convenience (CPC)', expiry: '2025-07-28' },
            { vessel: 'MBCA Luntian II', certificate: 'Ship Safety Certificate', expiry: '2025-08-15' },
            { vessel: 'MBCA Bayanihan', certificate: 'Certificate of Public Convenience (CPC)', expiry: '2026-01-10' },
            { vessel: 'MBCA Luntian I', certificate: 'Ship Safety Certificate', expiry: '2025-07-20' },
        ],
        financials: {
            revenue: 450000,
            expenses: 320000,
            netSurplus: 130000,
        },
        auditLog: [
            { date: '2025-06-25', activity: 'Surprise cash count conducted on main office cashier.', finding: 'No discrepancies found.' },
            { date: '2025-06-15', activity: 'Monthly Bank Reconciliation review.', finding: 'All accounts reconciled and approved.' },
            { date: '2025-05-20', activity: 'Tour Provisions Spot-Check on MBCA Luntian II.', finding: 'Minor deviation on fruit presentation. Corrective action advised.' },
        ],
        guestSatisfaction: 8.8,
        lastCashCount: '2025-06-25',
        // NEW MOCK DATA
        topContributors: [
            { name: 'Juan Dela Cruz', amount: 12500, vessel: 'MBCA Luntian I' },
            { name: 'Maria Santos', amount: 11800, vessel: 'MBCA Bayanihan' },
            { name: 'Pedro Reyes', amount: 10500, vessel: 'MBCA Luntian II' },
            { name: 'Ana Garcia', amount: 9800, vessel: 'MBCA Kalikasan' },
        ],
        latestExpenses: [
            { date: '2025-07-04', item: 'Fuel for Fleet (1 week)', amount: 45000 },
            { date: '2025-07-02', item: 'Office Supplies & Printing', amount: 8500 },
            { date: '2025-06-30', item: 'Employee Payroll (June 16-30)', amount: 150000 },
            { date: '2025-06-28', item: 'Repair of MBCA Bayanihan Engine', amount: 22000 },
        ],
        upcomingEvents: [
            { date: '2025-07-14', time: '2:00 PM', event: 'Regular Board of Directors Meeting' },
            { date: '2025-07-20', time: '9:00 AM', event: 'Luntian Committee Project Planning' },
            { date: '2025-07-25', time: 'All Day', event: 'Deadline for Q3 Budget Submission' },
        ]
    };

    // --- RENDER FUNCTIONS (including new ones) ---

    function renderLTS(projects) {
        const tableBody = document.getElementById('lts-table-body');
        tableBody.innerHTML = '';
        projects.forEach(p => {
            let statusClass = '';
            let statusDotClass = '';
            switch (p.status) {
                case 'On Track': statusClass = 'text-green-800 bg-green-100'; statusDotClass = 'bg-green-500'; break;
                case 'Delayed': statusClass = 'text-red-800 bg-red-100'; statusDotClass = 'bg-red-500'; break;
                case 'Completed': statusClass = 'text-gray-800 bg-gray-100'; statusDotClass = 'bg-gray-500'; break;
                case 'Planning': statusClass = 'text-blue-800 bg-blue-100'; statusDotClass = 'bg-blue-500'; break;
            }
            const row = `
                <tr class="bg-white border-b hover:bg-gray-50">
                    <td class="px-6 py-4 font-medium text-gray-900">${p.title}</td>
                    <td class="px-6 py-4">${p.pic}</td>
                    <td class="px-6 py-4">
                        <span class="px-2 py-1 font-semibold leading-tight rounded-full ${statusClass}">
                           <span class="status-dot ${statusDotClass}"></span> ${p.status}
                        </span>
                    </td>
                    <td class="px-6 py-4">${p.lastUpdate}</td>
                </tr>
            `;
            tableBody.innerHTML += row;
        });
    }

    function renderCompliance() {
        const tableBody = document.getElementById('compliance-table-body');
        tableBody.innerHTML = '';
        const today = new Date();
        let alerts = 0;

        mockData.compliance.sort((a, b) => new Date(a.expiry) - new Date(b.expiry));

        mockData.compliance.forEach(c => {
            const expiryDate = new Date(c.expiry);
            const diffTime = expiryDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            let statusText = `${diffDays} days remaining`;
            let statusClass = 'text-green-800 bg-green-100';
            if (diffDays <= 0) {
                statusText = 'Expired';
                statusClass = 'text-white bg-red-600';
                alerts++;
            } else if (diffDays <= 30) {
                statusText = `Expires in ${diffDays} days`;
                statusClass = 'text-red-800 bg-red-100';
                alerts++;
            } else if (diffDays <= 60) {
                 statusText = `Expires in ${diffDays} days`;
                statusClass = 'text-yellow-800 bg-yellow-100';
            }

            const row = `
                 <tr class="bg-white border-b hover:bg-gray-50">
                    <td class="px-6 py-4 font-medium text-gray-900">${c.vessel}</td>
                    <td class="px-6 py-4">${c.certificate}</td>
                    <td class="px-6 py-4">${c.expiry}</td>
                    <td class="px-6 py-4">
                        <span class="px-2 py-1 font-semibold leading-tight rounded-full ${statusClass}">
                           ${statusText}
                        </span>
                    </td>
                </tr>
            `;
            tableBody.innerHTML += row;
        });
        document.getElementById('compliance-alerts-count').textContent = alerts;
    }

    function renderFinancialsChart() {
        const ctx = document.getElementById('financials-chart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Revenue', 'Expenses', 'Net Surplus'],
                datasets: [{
                    label: 'Amount (PHP)',
                    data: [mockData.financials.revenue, mockData.financials.expenses, mockData.financials.netSurplus],
                    backgroundColor: [
                        'rgba(16, 185, 129, 0.2)', // Emerald
                        'rgba(239, 68, 68, 0.2)',  // Red
                        'rgba(59, 130, 246, 0.2)', // Blue
                    ],
                    borderColor: [
                        'rgba(5, 150, 105, 1)',
                        'rgba(220, 38, 38, 1)',
                        'rgba(37, 99, 235, 1)',
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value, index, values) {
                                return 'â‚±' + new Intl.NumberFormat().format(value);
                            }
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    }
    
    function renderAuditLog() {
        const logContainer = document.getElementById('audit-log');
        logContainer.innerHTML = '';
        mockData.auditLog.forEach(log => {
            const item = `
                <li class="flex items-start">
                    <div class="flex-shrink-0">
                        <div class="h-10 w-10 rounded-full bg-gray-100 flex items-center justify-center">
                           <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                        </div>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-900">${log.activity}</p>
                        <p class="text-sm text-gray-500">${log.finding}</p>
                        <p class="text-xs text-gray-400 mt-1">${log.date}</p>
                    </div>
                </li>
            `;
            logContainer.innerHTML += item;
        });
    }

    // NEW RENDER FUNCTIONS
    function renderTopContributors() {
        const list = document.getElementById('top-contributors-list');
        list.innerHTML = '';
        const icons = ['ðŸ¥‡', 'ðŸ¥ˆ', 'ðŸ¥‰', ''];
        mockData.topContributors.forEach((c, index) => {
            const item = `
                <li class="flex items-center">
                    <span class="text-2xl mr-4">${icons[index] || 'â€¢'}</span>
                    <div class="flex-1">
                        <p class="font-semibold text-gray-800">${c.name}</p>
                        <p class="text-sm text-gray-500">${c.vessel}</p>
                    </div>
                    <p class="font-bold text-emerald-600">â‚±${new Intl.NumberFormat().format(c.amount)}</p>
                </li>
            `;
            list.innerHTML += item;
        });
    }

    function renderLatestExpenses() {
        const list = document.getElementById('latest-expenses-list');
        list.innerHTML = '';
        mockData.latestExpenses.forEach(e => {
            const item = `
                <li class="flex items-center border-b border-gray-100 pb-3">
                    <div class="flex-1">
                        <p class="font-medium text-gray-800">${e.item}</p>
                        <p class="text-xs text-gray-400">${e.date}</p>
                    </div>
                    <p class="font-semibold text-red-600">- â‚±${new Intl.NumberFormat().format(e.amount)}</p>
                </li>
            `;
            list.innerHTML += item;
        });
    }

    function renderUpcomingEvents() {
        const list = document.getElementById('upcoming-events-list');
        list.innerHTML = '';
        mockData.upcomingEvents.forEach(e => {
            const item = `
                <li class="flex items-center border-b border-gray-100 pb-3">
                    <div class="bg-blue-100 text-blue-800 font-bold rounded-lg p-3 text-center mr-4">
                        <p class="text-xs">${new Date(e.date).toLocaleString('en-US', { month: 'short' })}</p>
                        <p class="text-xl">${new Date(e.date).getDate()}</p>
                    </div>
                    <div class="flex-1">
                        <p class="font-medium text-gray-800">${e.event}</p>
                        <p class="text-sm text-gray-500">${e.time}</p>
                    </div>
                </li>
            `;
            list.innerHTML += item;
        });
    }


    // --- INITIALIZE DASHBOARD ---
    
    // Set last updated time
    document.getElementById('last-updated').textContent = new Date().toLocaleString('en-US', { dateStyle: 'long', timeStyle: 'short' });

    // Populate Key Metrics
    document.getElementById('active-projects-count').textContent = mockData.ltsProjects.filter(p => p.status !== 'Completed').length;
    document.getElementById('guest-satisfaction-score').textContent = `${mockData.guestSatisfaction}/9.0`;
    document.getElementById('last-cash-count-date').textContent = mockData.lastCashCount;

    // Render all sections
    renderLTS(mockData.ltsProjects);
    renderCompliance();
    renderFinancialsChart();
    renderAuditLog();
    renderTopContributors();
    renderLatestExpenses();
    renderUpcomingEvents();
    
    // --- EVENT LISTENERS ---
    const ltsSearchInput = document.getElementById('lts-search');
    ltsSearchInput.addEventListener('keyup', (e) => {
        const searchTerm = e.target.value.toLowerCase();
        const filteredProjects = mockData.ltsProjects.filter(p => 
            p.title.toLowerCase().includes(searchTerm) || 
            p.pic.toLowerCase().includes(searchTerm)
        );
        renderLTS(filteredProjects);
    });
});
</script>

</body>
</html>
