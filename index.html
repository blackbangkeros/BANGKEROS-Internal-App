<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital BANGKEROS App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* Slate 100 */
        }
        .nav-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            color: #4b5563; /* Gray-600 */
            border-radius: 0.5rem;
            transition: all 0.2s ease-in-out;
            font-weight: 500;
        }
        .nav-link:hover {
            background-color: #f3f4f6; /* Gray-100 */
            color: #1f2937; /* Gray-800 */
        }
        .nav-link.active {
            background-color: #ecfdf5; /* Emerald-50 */
            color: #065f46; /* Emerald-800 */
            font-weight: 600;
        }
        .nav-link svg {
            margin-right: 0.75rem;
        }
        .content-pane {
            display: none;
        }
        .content-pane.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal-container {
            background-color: rgba(0, 0, 0, 0.6);
            transition: opacity 0.3s ease;
        }
        /* For AI Generator */
        .ai-suggestion {
            animation: slideInUp 0.5s ease-out;
        }
        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .gemini-button {
            background: linear-gradient(to right, #4c82fb, #2dd4bf);
        }
    </style>
</head>
<body class="antialiased text-gray-800">

    <div id="login-page" class="flex items-center justify-center min-h-screen bg-gray-100">
        <div class="w-full max-w-md p-8 space-y-6 bg-white rounded-2xl shadow-lg">
            <div class="text-center">
                <img src="https://raw.githubusercontent.com/js-fan/logo-hosting/main/bangkeros_seal.png" alt="BANGKEROS Logo" class="w-20 h-20 mx-auto" onerror="this.onerror=null;this.src='https://placehold.co/80x80/ffffff/059669?text=B';">
                <h1 class="mt-4 text-2xl font-bold text-gray-900">Digital BANGKEROS Portal</h1>
                <p class="text-sm text-gray-600">Please sign in to continue</p>
            </div>
            <form id="login-form" class="space-y-6">
                <div>
                    <label for="username" class="text-sm font-medium text-gray-700">Username</label>
                    <input id="username" name="username" type="text" required class="w-full px-3 py-2 mt-1 border border-gray-300 rounded-md shadow-sm focus:ring-emerald-500 focus:border-emerald-500" value="chairperson@bangkeros.coop">
                </div>
                <div>
                    <label for="password" class="text-sm font-medium text-gray-700">Password</label>
                    <input id="password" name="password" type="password" required class="w-full px-3 py-2 mt-1 border border-gray-300 rounded-md shadow-sm focus:ring-emerald-500 focus:border-emerald-500" value="password">
                </div>
                <div>
                    <button type="submit" class="w-full px-4 py-2 font-semibold text-white bg-emerald-600 rounded-md hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500">
                        Sign In
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="main-app" class="min-h-screen flex hidden">
        <aside class="w-64 bg-white shadow-lg flex-shrink-0 flex flex-col">
            <div class="h-20 flex items-center justify-center border-b-2 border-gray-100">
                <img src="https://raw.githubusercontent.com/js-fan/logo-hosting/main/bangkeros_seal.png" alt="BANGKEROS Logo" class="h-14" onerror="this.onerror=null;this.src='https://placehold.co/150x50/ffffff/059669?text=BANGKEROS';">
            </div>
            <nav id="main-nav" class="flex-1 p-4 space-y-1">
                <a href="#dashboard" class="nav-link">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                    Dashboard
                </a>
                <a href="#membership" class="nav-link">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                    My Profile
                </a>
                <a href="#compliance" class="nav-link">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 20.417l4.5-4.5M12 14a3 3 0 100-6 3 3 0 000 6z"></path></svg>
                    Compliance
                </a>
                <a href="#committees" class="nav-link">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg>
                    All Committees
                </a>
		<a href="#bod" class="nav-link active">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                    Board of Directors
                </a>
            </nav>
            <div class="mt-auto p-4 border-t-2 border-gray-100">
                 <button id="logout-btn" class="w-full flex items-center justify-center px-4 py-2 text-sm font-medium text-red-600 bg-red-50 rounded-lg hover:bg-red-100">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                    Logout
                </button>
            </div>
        </aside>

        <div class="flex-1 flex flex-col">
            <header class="h-20 bg-white shadow-sm flex items-center justify-between px-6 md:px-10 flex-shrink-0">
                <h1 id="page-title" class="text-2xl font-bold text-gray-800">Board of Directors</h1>
                <div class="relative">
                    <button id="profile-btn" class="flex items-center space-x-3">
                        <span id="profile-name" class="font-semibold text-gray-700 text-right hidden md:block"></span>
                        <img class="h-10 w-10 rounded-full" src="https://placehold.co/40x40/059669/FFFFFF?text=MC" alt="User Profile">
                    </button>
                </div>
            </header>
            
            <main id="main-content" class="flex-1 p-6 md:p-10 overflow-y-auto">
                <div id="dashboard-pane" class="content-pane"></div>
                <div id="membership-pane" class="content-pane"></div>
                <div id="compliance-pane" class="content-pane"></div>
                
                <div id="bod-pane" class="content-pane active">
                    <div id="bod-policy-view">
                        <div class="bg-white p-6 rounded-lg shadow-sm">
                            <h2 class="text-2xl font-bold text-gray-800 mb-4">Guiding Policies for the Board</h2>
                            <p class="text-gray-600 mb-6">Before using the governance tools, please review the key policies that govern the duties and responsibilities of the Board of Directors.</p>
                            <div class="space-y-4 text-sm p-4 bg-gray-50 rounded-lg border">
                                <div>
                                    <h3 class="font-bold text-gray-700">Code of Good Governance (Policy No. 06310-RS2025)</h3>
                                    <ul class="list-disc list-inside ml-4 text-gray-600">
                                        <li>The Board is responsible for strategic direction, policy formulation, and financial oversight.</li>
                                        <li>Individual directors have a duty of care, loyalty, and obedience to the cooperative.</li>
                                    </ul>
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-700">Master Formulation & Documentation Policy (GOV-POL-002)</h3>
                                    <ul class="list-disc list-inside ml-4 text-gray-600">
                                        <li>All new policies and resolutions must follow the official formulation procedures.</li>
                                        <li>All documents must use the standard cooperative coding and numbering system.</li>
                                    </ul>
                                </div>
                            </div>
                             <div class="mt-6 flex items-center">
                                <input id="bod-ack-checkbox" type="checkbox" class="h-4 w-4 text-emerald-600 border-gray-300 rounded focus:ring-emerald-500">
                                <label for="bod-ack-checkbox" class="ml-2 block text-sm text-gray-900">I have reviewed the guiding policies.</label>
                            </div>
                            <div class="mt-4 text-right">
                                <button id="proceed-to-tools-btn" class="px-6 py-2 bg-emerald-600 text-white font-semibold rounded-lg hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                    Proceed to Governance Tools
                                </button>
                            </div>
                        </div>
                    </div>

                    <div id="bod-generator-view" class="hidden">
                         <button id="back-to-policies-btn" class="mb-4 px-4 py-2 bg-gray-200 text-sm font-medium rounded-lg hover:bg-gray-300">&larr; Back to Policies</button>
                         <div class="flex space-x-4 border-b mb-6">
                            <button id="gen-mode-btn" class="py-2 px-4 font-semibold border-b-2 border-emerald-500 text-emerald-600">✨ AI Document Generator</button>
                            <button id="meeting-mode-btn" class="py-2 px-4 font-semibold text-gray-500 border-b-2 border-transparent">✨ AI Live Meeting Mode</button>
                            <button id="proposal-helper-btn" class="py-2 px-4 font-semibold text-gray-500 border-b-2 border-transparent">✨ AI Proposal Helper</button>
                        </div>
                        
                        <div id="generator-mode-content">
                            <div class="bg-white p-6 rounded-lg shadow-sm">
                                <h2 class="text-xl font-bold mb-4">Luntian AI Document Generator</h2>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label for="doc-type" class="block text-sm font-medium text-gray-700">1. Select Document Type</label>
                                        <select id="doc-type" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500 sm:text-sm">
                                            <option>Resolution</option>
                                            <option>Policy</option>
                                            <option>Project Proposal</option>
                                        </select>
                                    </div>
                                    <div class="md:col-span-2">
                                        <label for="doc-prompt" class="block text-sm font-medium text-gray-700">2. Describe the document you need</label>
                                        <textarea id="doc-prompt" rows="4" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500 sm:text-sm" placeholder="Example: 'A resolution appointing Juan Dela Cruz as the new head of the Luntian Committee.'"></textarea>
                                    </div>
                                </div>
                                <div class="text-right mt-4">
                                    <button id="generate-doc-btn" class="gemini-button inline-flex items-center px-6 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500">
                                        ✨ Generate with Gemini
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div id="meeting-mode-content" class="hidden">
                             <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                                <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-sm">
                                    <h2 class="text-xl font-bold mb-4">Live Meeting Assistant</h2>
                                    <label for="meeting-transcript" class="block text-sm font-medium text-gray-700">Meeting Transcript (Simulated)</label>
                                    <textarea id="meeting-transcript" rows="10" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm" placeholder="As topics are typed here, the AI assistant will provide suggestions..."></textarea>
                                </div>
                                <div class="space-y-6">
                                    <div class="bg-white p-4 rounded-lg shadow-sm">
                                        <h3 class="text-lg font-bold mb-2">Luntian AI Assistant</h3>
                                        <div id="ai-suggestions" class="space-y-3 text-sm">
                                            <p class="text-gray-500">Suggestions will appear here...</p>
                                        </div>
                                    </div>
                                </div>
                             </div>
                        </div>
                        
                        <div id="proposal-helper-content" class="hidden">
                            <div class="bg-white p-6 rounded-lg shadow-sm">
                                <h2 class="text-xl font-bold mb-4">AI Project Proposal Helper</h2>
                                <form id="proposal-form" class="space-y-4">
                                    <div><label class="block text-sm font-medium">Project Title</label><input type="text" name="proj_title" class="w-full mt-1 border-gray-300 rounded-md" placeholder="e.g., Luntian Coastal Clean-up 2025"></div>
                                    <div><label class="block text-sm font-medium">Rationale (Why is this needed?)</label><textarea name="proj_rationale" rows="3" class="w-full mt-1 border-gray-300 rounded-md"></textarea></div>
                                    <div><label class="block text-sm font-medium">Objectives (What will it achieve?)</label><textarea name="proj_objectives" rows="3" class="w-full mt-1 border-gray-300 rounded-md"></textarea></div>
                                    <div class="text-right">
                                        <button type="submit" class="gemini-button inline-flex items-center px-6 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white">✨ Draft Proposal with Gemini</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="committees-pane" class="content-pane">
                     <div class="bg-white p-6 rounded-lg shadow-sm">
                        <h2 class="text-xl font-bold mb-4">Committee Oversight</h2>
                        <p class="text-gray-600 mb-6">All committees are governed by the Master Committee Charter and report to their respective accountability body. Use the forms below for official committee actions.</p>
                        <div class="border-t pt-6">
                            <h3 class="font-semibold text-lg text-gray-800 mb-4">Forms & Reporting</h3>
                            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                                <button onclick="showFormModal('form-incident-report')" class="p-4 bg-gray-100 rounded-lg text-center font-medium hover:bg-emerald-100 hover:text-emerald-800 transition">Incident Report</button>
                                <button onclick="showFormModal('form-gad-plan')" class="p-4 bg-gray-100 rounded-lg text-center font-medium hover:bg-emerald-100 hover:text-emerald-800 transition">GAD Plan & Budget</button>
                                <button onclick="showFormModal('form-audit-plan')" class="p-4 bg-gray-100 rounded-lg text-center font-medium hover:bg-emerald-100 hover:text-emerald-800 transition">Annual Audit Plan</button>
                                <button onclick="showFormModal('form-coc')" class="p-4 bg-gray-100 rounded-lg text-center font-medium hover:bg-emerald-100 hover:text-emerald-800 transition">Certificate of Candidacy</button>
                                <button onclick="showFormModal('form-election-protest')" class="p-4 bg-gray-100 rounded-lg text-center font-medium hover:bg-emerald-100 hover:text-emerald-800 transition">Election Protest</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="finance-pane" class="content-pane">
                    <div class="bg-white p-6 rounded-lg shadow-sm mb-8">
                        <h2 class="text-xl font-bold mb-4">Financial Management</h2>
                        <p class="text-gray-600 mb-4">Governed by the CASA Policy and General Accounting System Manual.</p>
                         <ul class="list-disc list-inside space-y-2 text-gray-700">
                            <li>All disbursements require approval based on the CASA matrix.</li>
                            <li>All cash collections must be deposited intact daily.</li>
                            <li>Bank accounts must be reconciled monthly by the 15th.</li>
                            <li>Surprise cash counts are conducted monthly by the Audit Committee.</li>
                        </ul>
                         <div class="border-t pt-6 mt-6">
                            <h3 class="font-semibold text-lg text-gray-800 mb-4">Forms & Reporting</h3>
                            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                                <button onclick="showFormModal('form-pr')" class="p-4 bg-gray-100 rounded-lg text-center font-medium hover:bg-emerald-100 hover:text-emerald-800 transition">Purchase Request</button>
                                <button onclick="showFormModal('form-dv')" class="p-4 bg-gray-100 rounded-lg text-center font-medium hover:bg-emerald-100 hover:text-emerald-800 transition">Disbursement Voucher</button>
                                <button onclick="showFormModal('form-ca')" class="p-4 bg-gray-100 rounded-lg text-center font-medium hover:bg-emerald-100 hover:text-emerald-800 transition">Cash Advance</button>
                                <button onclick="showFormModal('form-lr')" class="p-4 bg-gray-100 rounded-lg text-center font-medium hover:bg-emerald-100 hover:text-emerald-800 transition">Liquidation Report</button>
                                 <button onclick="showFormModal('form-cc')" class="p-4 bg-gray-100 rounded-lg text-center font-medium hover:bg-emerald-100 hover:text-emerald-800 transition">Cash Count Sheet</button>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <section class="bg-white p-6 rounded-lg shadow-sm">
                             <h2 class="text-xl font-bold mb-4">Monthly Financial Snapshot</h2>
                             <canvas id="financials-chart"></canvas>
                        </section>
                         <section class="bg-white p-6 rounded-lg shadow-sm">
                             <h2 class="text-xl font-bold mb-4">Internal Audit Log</h2>
                             <ul class="space-y-4" id="audit-log"></ul>
                        </section>
                    </div>
                </div>

                <div id="hr-pane" class="content-pane">
                    <div class="bg-white p-6 rounded-lg shadow-sm">
                        <h2 class="text-xl font-bold mb-4">Human Resource Management</h2>
                        <p class="text-gray-600 mb-4">Key policies for employees and officers.</p>
                         <ul class="list-disc list-inside space-y-2 text-gray-700">
                            <li>Employee salaries are governed by the Salary Standardization Policy (SG system).</li>
                            <li>Officer compensation (honorarium) must be approved by the General Assembly.</li>
                            <li>Employee leave benefits include 10 days of convertible SIL per year.</li>
                            <li>A formal grievance machinery and disciplinary procedure (due process) are in place.</li>
                        </ul>
                    </div>
                </div>

                <div id="operations-pane" class="content-pane">
                    <div class="bg-white p-6 rounded-lg shadow-sm">
                        <h2 class="text-xl font-bold mb-4">Operations Management</h2>
                        <p class="text-gray-600 mb-4">Standards for all cooperative services, primarily the Sea Service & Safety Policy.</p>
                        <ul class="list-disc list-inside space-y-2 text-gray-700">
                            <li>Strict adherence to PCG's "No-Sail" Policy.</li>
                            <li>Mandatory Passenger Manifest and Travel Voucher for every trip.</li>
                            <li>The 9-Point Meal Standard and 9-Point Guest Briefing are mandatory for all tours.</li>
                            <li>Strict enforcement of the Luntian Code of Conduct (No fish feeding, no touching corals).</li>
                        </ul>
                    </div>
                </div>

                <div id="digital-pane" class="content-pane">
                    <div class="bg-white p-6 rounded-lg shadow-sm">
                        <h2 class="text-xl font-bold mb-4">Digital BANGKEROS Department</h2>
                        <p class="text-gray-600 mb-4">Leads the cooperative's digital transformation.</p>
                        <div id="lts-section">
                             <h3 class="font-semibold mb-2">Luntian Tracking System (LTS)</h3>
                             <div class="overflow-x-auto">
                                <table class="w-full text-sm text-left">
                                    <thead class="bg-gray-50 text-xs text-gray-700 uppercase">
                                        <tr>
                                            <th class="px-6 py-3">Project / Concern</th>
                                            <th class="px-6 py-3">PIC</th>
                                            <th class="px-6 py-3">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="lts-table-body-digital"></tbody>
                                </table>
                            </div>
                        </div>
                        <div id="compliance-section" class="mt-6">
                            <h3 class="font-semibold mb-2">MARINA Compliance</h3>
                             <div class="overflow-x-auto">
                                <table class="w-full text-sm text-left">
                                    <thead class="bg-gray-50 text-xs text-gray-700 uppercase">
                                        <tr>
                                            <th class="px-6 py-3">Vessel</th>
                                            <th class="px-6 py-3">Certificate</th>
                                            <th class="px-6 py-3">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="compliance-table-body-digital"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="info-pane" class="content-pane">
                    <div class="bg-white p-6 rounded-lg shadow-sm">
                        <h2 class="text-xl font-bold mb-4">General Information</h2>
                        <p class="text-gray-600 mb-4">Core identity of the BANGKEROS Cooperative.</p>
                        <div class="space-y-4">
                            <div><strong class="text-emerald-700">Vision:</strong> To be a premier tourist service provider renowned for sustainability, quality, and community engagement.</div>
                            <div><strong class="text-emerald-700">Mission:</strong> To offer high-quality, safe experiences while promoting environmental responsibility.</div>
                            <div><strong class="text-emerald-700">Guiding Principle:</strong> The "9th of BANGKEROS" - where Quality (Kalidad) is King and Justice (Katarungan) is the absolute Order.</div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Form Modal -->
    <div id="form-modal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 form-modal-container">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col form-modal-content scale-95">
            <header id="form-modal-header" class="p-4 border-b flex justify-between items-center">
                <h2 id="form-modal-title" class="text-lg font-bold">Form Title</h2>
                <button id="form-modal-close-btn" class="text-gray-400 hover:text-gray-600">&times;</button>
            </header>
            <div id="form-modal-body" class="p-6 overflow-y-auto">
                <!-- Form content will be injected here -->
            </div>
            <footer class="p-4 bg-gray-50 border-t flex justify-end space-x-4">
                <button id="form-modal-cancel-btn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">Cancel</button>
                <button id="form-modal-submit-btn" class="px-4 py-2 bg-emerald-600 text-white rounded-md hover:bg-emerald-700">Submit Report</button>
            </footer>
        </div>
    </div>

    <!-- Report Display Modal -->
    <div id="report-modal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 form-modal-container">
         <div class="bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] flex flex-col form-modal-content scale-95">
            <header class="p-4 border-b flex justify-between items-center">
                <h2 class="text-lg font-bold">Generated Report</h2>
                <button id="report-modal-close-btn" class="text-gray-400 hover:text-gray-600">&times;</button>
            </header>
            <div id="report-modal-body" class="p-6 overflow-y-auto">
                <!-- Report content will be injected here -->
            </div>
            <footer class="p-4 bg-gray-50 border-t flex justify-end">
                <button id="report-modal-ok-btn" class="px-4 py-2 bg-emerald-600 text-white rounded-md hover:bg-emerald-700">OK</button>
            </footer>
        </div>
    </div>

    <!-- Hidden Form Templates -->
    <div id="form-templates" class="hidden">
        <!-- Add all form HTML snippets here -->
        <div id="template-form-pr">
            <form id="form-pr-actual">
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div><label class="block text-sm font-medium">Department/Committee</label><input type="text" name="department" class="w-full mt-1 border-gray-300 rounded-md shadow-sm"></div>
                    <div><label class="block text-sm font-medium">PR No.</label><input type="text" name="pr_no" class="w-full mt-1 border-gray-300 rounded-md shadow-sm"></div>
                </div>
                <table class="w-full text-sm">
                    <thead><tr class="bg-gray-50">
                        <th class="p-2">Qty</th><th class="p-2">Unit</th><th class="p-2">Item Description</th><th class="p-2">Purpose</th>
                    </tr></thead>
                    <tbody><tr>
                        <td><input type="number" name="qty1" class="w-full border-gray-300 rounded-md"></td>
                        <td><input type="text" name="unit1" class="w-full border-gray-300 rounded-md"></td>
                        <td><input type="text" name="desc1" class="w-full border-gray-300 rounded-md"></td>
                        <td><input type="text" name="purpose1" class="w-full border-gray-300 rounded-md"></td>
                    </tr></tbody>
                </table>
            </form>
        </div>
        <div id="template-form-dv">
             <form id="form-dv-actual">
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div><label class="block text-sm font-medium">Payee</label><input type="text" name="payee" class="w-full mt-1 border-gray-300 rounded-md shadow-sm"></div>
                    <div><label class="block text-sm font-medium">Voucher No.</label><input type="text" name="voucher_no" class="w-full mt-1 border-gray-300 rounded-md shadow-sm"></div>
                </div>
                <div><label class="block text-sm font-medium">Particulars</label><textarea name="particulars" rows="3" class="w-full mt-1 border-gray-300 rounded-md shadow-sm"></textarea></div>
                <div class="mt-4"><label class="block text-sm font-medium">Amount</label><input type="number" name="amount" class="w-full mt-1 border-gray-300 rounded-md shadow-sm"></div>
            </form>
        </div>
        <div id="template-form-ca">
            <form id="form-ca-actual">
                <div class="mb-4"><label class="block text-sm font-medium">Payee (Name)</label><input type="text" name="payee_name" class="w-full mt-1 border-gray-300 rounded-md shadow-sm"></div>
                <div class="mb-4"><label class="block text-sm font-medium">Purpose of Advance</label><input type="text" name="purpose" class="w-full mt-1 border-gray-300 rounded-md shadow-sm"></div>
                <div class="mb-4"><label class="block text-sm font-medium">Amount Requested</label><input type="number" name="amount_requested" class="w-full mt-1 border-gray-300 rounded-md shadow-sm"></div>
            </form>
        </div>
         <div id="template-form-lr">
            <form id="form-lr-actual">
                <div class="mb-4"><label class="block text-sm font-medium">Cash Advance No. (if any)</label><input type="text" name="ca_no" class="w-full mt-1 border-gray-300 rounded-md shadow-sm"></div>
                <div class="mb-4"><label class="block text-sm font-medium">Total Expenses</label><input type="number" name="total_expenses" class="w-full mt-1 border-gray-300 rounded-md shadow-sm"></div>
                <p class="text-sm mt-2">Please attach all original receipts.</p>
            </form>
        </div>
         <div id="template-form-cc">
            <form id="form-cc-actual">
                <div class="mb-4"><label class="block text-sm font-medium">Accountable Officer</label><input type="text" name="accountable_officer" class="w-full mt-1 border-gray-300 rounded-md shadow-sm"></div>
                <div class="mb-4"><label class="block text-sm font-medium">Total Cash Counted</label><input type="number" name="cash_counted" class="w-full mt-1 border-gray-300 rounded-md shadow-sm"></div>
                <div class="mb-4"><label class="block text-sm font-medium">Accountability per Record</label><input type="number" name="accountability" class="w-full mt-1 border-gray-300 rounded-md shadow-sm"></div>
            </form>
        </div>
        <div id="template-form-incident-report">
            <form id="form-incident-report-actual">
                <div class="mb-4"><label class="block text-sm font-medium">Person(s) Subject of Complaint</label><input type="text" name="respondent" class="w-full mt-1 border-gray-300 rounded-md shadow-sm"></div>
                <div class="mb-4"><label class="block text-sm font-medium">Detailed Narration</label><textarea name="narration" rows="4" class="w-full mt-1 border-gray-300 rounded-md shadow-sm"></textarea></div>
            </form>
        </div>
        <div id="template-form-gad-plan">
             <form id="form-gad-plan-actual">
                <div class="mb-4"><label class="block text-sm font-medium">Program/Project Title</label><input type="text" name="program_title" class="w-full mt-1 border-gray-300 rounded-md shadow-sm"></div>
                <div class="mb-4"><label class="block text-sm font-medium">Objective</label><textarea name="objective" rows="3" class="w-full mt-1 border-gray-300 rounded-md shadow-sm"></textarea></div>
                <div class="mb-4"><label class="block text-sm font-medium">Proposed Budget (PHP)</label><input type="number" name="budget" class="w-full mt-1 border-gray-300 rounded-md shadow-sm"></div>
            </form>
        </div>
        <div id="template-form-audit-plan">
             <form id="form-audit-plan-actual">
                <div class="mb-4"><label class="block text-sm font-medium">Audit Area / Activity</label><input type="text" name="audit_area" class="w-full mt-1 border-gray-300 rounded-md shadow-sm"></div>
                <div class="mb-4"><label class="block text-sm font-medium">Target Quarter</label><input type="text" name="quarter" placeholder="e.g., Q3" class="w-full mt-1 border-gray-300 rounded-md shadow-sm"></div>
                <div class="mb-4"><label class="block text-sm font-medium">Objective</label><textarea name="objective" rows="3" class="w-full mt-1 border-gray-300 rounded-md shadow-sm"></textarea></div>
            </form>
        </div>
        <div id="template-form-coc">
             <form id="form-coc-actual">
                <div class="mb-4"><label class="block text-sm font-medium">Name of Candidate</label><input type="text" name="candidate_name" class="w-full mt-1 border-gray-300 rounded-md shadow-sm"></div>
                <div class="mb-4"><label class="block text-sm font-medium">Position Seeking</label><input type="text" name="position" class="w-full mt-1 border-gray-300 rounded-md shadow-sm"></div>
            </form>
        </div>
        <div id="template-form-election-protest">
             <form id="form-election-protest-actual">
                <div class="mb-4"><label class="block text-sm font-medium">Protestant(s) Name</label><input type="text" name="protestant_name" class="w-full mt-1 border-gray-300 rounded-md shadow-sm"></div>
                <div class="mb-4"><label class="block text-sm font-medium">Nature of Protest</label><textarea name="nature_of_protest" rows="4" class="w-full mt-1 border-gray-300 rounded-md shadow-sm"></textarea></div>
            </form>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    // --- PAGE ELEMENTS ---
    const loginPage = document.getElementById('login-page');
    const mainApp = document.getElementById('main-app');
    const loginForm = document.getElementById('login-form');
    const logoutBtn = document.getElementById('logout-btn');
    const mainNav = document.getElementById('main-nav');
    const pageTitle = document.getElementById('page-title');
    const contentPanes = document.querySelectorAll('.content-pane');
    const profileName = document.getElementById('profile-name');
    const formModal = document.getElementById('form-modal');
    const formModalTitle = document.getElementById('form-modal-title');
    const formModalBody = document.getElementById('form-modal-body');
    const formModalSubmitBtn = document.getElementById('form-modal-submit-btn');
    const formModalCloseBtn = document.getElementById('form-modal-close-btn');
    const formModalCancelBtn = document.getElementById('form-modal-cancel-btn');
    const reportModal = document.getElementById('report-modal');
    const reportModalBody = document.getElementById('report-modal-body');
    const reportModalCloseBtn = document.getElementById('report-modal-close-btn');
    const reportModalOkBtn = document.getElementById('report-modal-ok-btn');

    // --- BOD PANE ELEMENTS ---
    const bodPane = document.getElementById('bod-pane');
    const bodPolicyView = document.getElementById('bod-policy-view');
    const bodGeneratorView = document.getElementById('bod-generator-view');
    const bodAckCheckbox = document.getElementById('bod-ack-checkbox');
    const proceedToToolsBtn = document.getElementById('proceed-to-tools-btn');
    const backToPoliciesBtn = document.getElementById('back-to-policies-btn');

    // --- GENERATOR ELEMENTS ---
    const genModeBtn = document.getElementById('gen-mode-btn');
    const meetingModeBtn = document.getElementById('meeting-mode-btn');
    const proposalHelperBtn = document.getElementById('proposal-helper-btn');
    const genModeContent = document.getElementById('generator-mode-content');
    const meetingModeContent = document.getElementById('meeting-mode-content');
    const proposalHelperContent = document.getElementById('proposal-helper-content');
    const generateDocBtn = document.getElementById('generate-doc-btn');
    const proposalForm = document.getElementById('proposal-form');
    const docOutputModal = document.getElementById('doc-output-modal');
    const docOutputBody = document.getElementById('doc-output-body');
    const docModalCloseBtn = document.getElementById('doc-modal-close-btn');
    const docOkBtn = document.getElementById('doc-ok-btn');
    const docCopyBtn = document.getElementById('doc-copy-btn');
    const meetingTranscript = document.getElementById('meeting-transcript');
    const aiSuggestions = document.getElementById('ai-suggestions');
    const ltsMeetingView = document.getElementById('lts-meeting-view');

 // --- MOCK DATA (abbreviated) ---
    const mockData = {
        ltsProjects: [
            { id: 'LTS-001', title: 'Luntian Genesis Reef - Pilot', pic: 'Luntian Committee', status: 'On Track', lastUpdate: '2025-07-03' },
            { id: 'LTS-002', title: 'Aquaculture Farm Setup', pic: 'Fishermen Sector', status: 'On Track', lastUpdate: '2025-07-01' },
            { id: 'LTS-003', title: 'Request for LGU Meeting', pic: 'Board Secretary', status: 'Completed', lastUpdate: '2025-06-28' },
            { id: 'LTS-004', title: 'Q3 Training Plan (ATEP)', pic: 'Education Committee', status: 'Planning', lastUpdate: '2025-06-30' },
            { id: 'LTS-005', title: 'Maiden Marshals Uniforms', pic: 'GAD Committee', status: 'Delayed', lastUpdate: '2025-06-25' },
        ],
        compliance: [
            { vessel: 'MBCA Luntian I', certificate: 'CPC', expiry: '2025-07-28' },
            { vessel: 'MBCA Luntian II', certificate: 'PSSC', expiry: '2025-08-15' },
            { vessel: 'MBCA Bayanihan', certificate: 'CPC', expiry: '2026-01-10' },
            { vessel: 'MBCA Luntian I', certificate: 'PSSC', expiry: '2025-07-20' },
        ],
        financials: { revenue: 450000, expenses: 320000, netSurplus: 130000 },
        auditLog: [
            { date: '2025-06-25', activity: 'Surprise cash count on main cashier.', finding: 'No discrepancies.' },
            { date: '2025-06-15', activity: 'Monthly Bank Reconciliation review.', finding: 'All accounts reconciled.' },
        ],
        guestSatisfaction: 8.8,
        lastCashCount: '2025-06-25',
        topContributors: [
            { name: 'Juan Dela Cruz', amount: 12500, vessel: 'MBCA Luntian I' },
            { name: 'Maria Santos', amount: 11800, vessel: 'MBCA Bayanihan' },
            { name: 'Pedro Reyes', amount: 10500, vessel: 'MBCA Luntian II' },
        ],
        latestExpenses: [
            { date: '2025-07-04', item: 'Fuel for Fleet (1 week)', amount: 45000 },
            { date: '2025-07-02', item: 'Office Supplies & Printing', amount: 8500 },
            { date: '2025-06-30', item: 'Employee Payroll (June 16-30)', amount: 150000 },
        ],
        upcomingEvents: [
            { date: '2025-07-14', time: '2:00 PM', event: 'Regular BOD Meeting' },
            { date: '2025-07-20', time: '9:00 AM', event: 'Luntian Committee Planning' },
        ]
  
    };
    
    // --- RENDER FUNCTIONS (abbreviated) ---
    function renderMemberProfile() { /* ... */ }

    // --- GENERATOR FUNCTIONS ---
    function switchGeneratorMode(mode) {
        const buttons = [genModeBtn, meetingModeBtn, proposalHelperBtn];
        const contents = [genModeContent, meetingModeContent, proposalHelperContent];
        
        buttons.forEach(btn => btn.classList.remove('border-emerald-500', 'text-emerald-600'));
        contents.forEach(content => content.classList.add('hidden'));

        if (mode === 'meeting') {
            meetingModeBtn.classList.add('border-emerald-500', 'text-emerald-600');
            meetingModeContent.classList.remove('hidden');
            renderLTSForMeeting();
        } else if (mode === 'proposal') {
            proposalHelperBtn.classList.add('border-emerald-500', 'text-emerald-600');
            proposalHelperContent.classList.remove('hidden');
        } else {
            genModeBtn.classList.add('border-emerald-500', 'text-emerald-600');
            genModeContent.classList.remove('hidden');
        }
    }

    // --- GEMINI API INTEGRATION ---
    async function callGeminiAPI(prompt) {
        const apiKey = ""; 
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

        const payload = {
            contents: [{
                role: "user",
                parts: [{ text: prompt }]
            }]
        };

        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                throw new Error(`API call failed with status: ${response.status}`);
            }

            const result = await response.json();
            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                return result.candidates[0].content.parts[0].text;
            } else {
                return "Error: Could not generate a valid response from the AI.";
            }
        } catch (error) {
            console.error("Gemini API Error:", error);
            return `Error: Could not connect to the AI service. Details: ${error.message}`;
        }
    }

    async function handleGenerateDocument() {
        const docType = document.getElementById('doc-type').value;
        const userPrompt = document.getElementById('doc-prompt').value;
        if (!userPrompt) {
            alert('Please describe the document you need.');
            return;
        }
        
        generateDocBtn.disabled = true;
        generateDocBtn.innerHTML = 'Generating...';

        const bangkerosContext = `
            You are an AI assistant for the BANGKEROS Cooperative's Board of Directors. Your task is to generate official documents. All documents must adhere to the following key policies:
            - Master Formulation and Documentation Policy (GOV-POL-002): All documents must have a proper code/number.
            - Policy Formulation Procedure (06201-RS2025): Policies must have a standard structure (Rationale, Scope, etc.).
            - Resolution Formulation Procedure (06202-RS2025): Resolutions must have WHEREAS clauses and a RESOLVED clause.
            - Code of Good Governance (06310-RS2025): All actions must be in the best interest of the general membership.
            - The 9th of BANGKEROS (06402-R-S2025): The ultimate principles are Quality (Kalidad) and Justice (Katarungan).
            
            Based on this context, please generate a formal and professional '${docType}' document for the following user request: "${userPrompt}"
        `;

        const generatedText = await callGeminiAPI(bangkerosContext);
        
        docOutputBody.innerHTML = `<pre class="whitespace-pre-wrap text-sm">${generatedText}</pre>`;
        docOutputModal.classList.remove('hidden');
        docOutputModal.classList.add('flex');
        generateDocBtn.disabled = false;
        generateDocBtn.innerHTML = '✨ Generate with Gemini';
    }

    async function handleProposalFormSubmit(e) {
        e.preventDefault();
        const formData = new FormData(e.target);
        const title = formData.get('proj_title');
        const rationale = formData.get('proj_rationale');
        const objectives = formData.get('proj_objectives');
        
        if (!title || !rationale || !objectives) {
            alert('Please fill out all fields for the proposal.');
            return;
        }

        const submitButton = e.target.querySelector('button[type="submit"]');
        submitButton.disabled = true;
        submitButton.innerHTML = 'Drafting...';

        const proposalPrompt = `
            As an AI assistant for the BANGKEROS Cooperative, create a formal Project Proposal document. The proposal must be aligned with the cooperative's 9 Pillars of Development.
            
            Use the following details provided by the user:
            - Project Title: ${title}
            - Rationale (Why it's needed): ${rationale}
            - Objectives (What it will achieve): ${objectives}
            
            Structure the proposal with the following sections: 1.0 RATIONALE, 2.0 PROJECT OBJECTIVES, 3.0 ALIGNMENT WITH 9 PILLARS, 4.0 PROPOSED BUDGET (use placeholder values), 5.0 CONCLUSION.
            Make it sound professional, persuasive, and ready for submission to a funding agency.
        `;

        const generatedText = await callGeminiAPI(proposalPrompt);

        docOutputBody.innerHTML = `<pre class="whitespace-pre-wrap text-sm">${generatedText}</pre>`;
        docOutputModal.classList.remove('hidden');
        docOutputModal.classList.add('flex');
        submitButton.disabled = false;
        submitButton.innerHTML = '✨ Draft Proposal with Gemini';
    }

    async function handleMeetingTranscriptInput() {
        const text = meetingTranscript.value;
        if (text.length < 50 || text.endsWith(' ') === false) return; // Only call API on pause

        const meetingPrompt = `
            You are an AI assistant for the BANGKEROS Cooperative board meeting. Based on the following transcript excerpt, identify key topics and suggest relevant policies or action items. Be concise.
            Transcript: "${text}"
        `;
        
        const suggestions = await callGeminiAPI(meetingPrompt);
        aiSuggestions.innerHTML = `<div class="ai-suggestion bg-blue-50 p-3 rounded-lg"><p class="font-semibold">AI Assistant:</p><p>${suggestions.replace(/\n/g, '<br>')}</p></div>`;
    }

    function renderLTSForMeeting() {
        if(!ltsMeetingView || !mockData.ltsProjects) return;
        ltsMeetingView.innerHTML = '';
        mockData.ltsProjects.forEach(p => {
            const statusColor = p.status === 'Delayed' ? 'text-red-500' : 'text-green-500';
            ltsMeetingView.innerHTML += `<div class="flex justify-between items-center"><p>${p.title}</p><p class="font-semibold ${statusColor}">${p.status}</p></div>`;
        });
    }

    // --- EVENT LISTENERS ---
    mainNav.addEventListener('click', (e) => {
        e.preventDefault();
        const targetLink = e.target.closest('.nav-link');
        if (!targetLink) return;
        mainNav.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
        targetLink.classList.add('active');
        const targetPaneId = targetLink.getAttribute('href').substring(1) + '-pane';
        contentPanes.forEach(pane => {
            pane.classList.toggle('active', pane.id === targetPaneId);
        });
        pageTitle.textContent = targetLink.textContent.trim();
        if (targetPaneId === 'bod-pane') {
            bodPolicyView.classList.remove('hidden');
            bodGeneratorView.classList.add('hidden');
            bodAckCheckbox.checked = false;
            proceedToToolsBtn.disabled = true;
        }
    });
    
    loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        profileName.textContent = document.getElementById('username').value.split('@')[0].replace(/\b\w/g, l => l.toUpperCase());
        loginPage.classList.add('hidden');
        mainApp.classList.remove('hidden');
        mainApp.classList.add('flex');
        mainNav.querySelector('a[href="#bod"]').click();
    });

    logoutBtn.addEventListener('click', () => {
        mainApp.classList.add('hidden');
        mainApp.classList.remove('flex');
        loginPage.classList.remove('hidden');
    });
    
    // --- BOD PANE LISTENERS ---
    bodAckCheckbox.addEventListener('change', () => {
        proceedToToolsBtn.disabled = !bodAckCheckbox.checked;
    });
    proceedToToolsBtn.addEventListener('click', () => {
        bodPolicyView.classList.add('hidden');
        bodGeneratorView.classList.remove('hidden');
        switchGeneratorMode('generator');
    });
    backToPoliciesBtn.addEventListener('click', () => {
        bodGeneratorView.classList.add('hidden');
        bodPolicyView.classList.remove('hidden');
    });

    // --- GENERATOR EVENT LISTENERS ---
    genModeBtn.addEventListener('click', () => switchGeneratorMode('generator'));
    meetingModeBtn.addEventListener('click', () => switchGeneratorMode('meeting'));
    proposalHelperBtn.addEventListener('click', () => switchGeneratorMode('proposal'));
    generateDocBtn.addEventListener('click', handleGenerateDocument);
    proposalForm.addEventListener('submit', handleProposalFormSubmit);
    docModalCloseBtn.addEventListener('click', () => docOutputModal.classList.add('hidden'));
    docOkBtn.addEventListener('click', () => docOutputModal.classList.add('hidden'));
    docCopyBtn.addEventListener('click', () => {
        const textToCopy = docOutputBody.querySelector('pre')?.innerText || docOutputBody.innerText;
        navigator.clipboard.writeText(textToCopy);
        alert('Document text copied to clipboard!');
    });
    meetingTranscript.addEventListener('input', handleMeetingTranscriptInput);

});

    // --- RENDER FUNCTIONS ---
    function renderAll() {
        renderLTS(mockData.ltsProjects);
        renderCompliance();
        renderTopContributors();
        renderLatestExpenses();
        renderUpcomingEvents();
        renderDigitalPaneTables();
        updateKeyMetrics();
    }

    function updateKeyMetrics() {
        document.getElementById('last-updated').textContent = new Date().toLocaleString('en-US', { dateStyle: 'long', timeStyle: 'short' });
        document.getElementById('active-projects-count').textContent = mockData.ltsProjects.filter(p => p.status !== 'Completed').length;
        document.getElementById('guest-satisfaction-score').textContent = `${mockData.guestSatisfaction}/9.0`;
        document.getElementById('last-cash-count-date').textContent = mockData.lastCashCount;
        let alerts = 0;
        const today = new Date();
        mockData.compliance.forEach(c => {
            const diffDays = Math.ceil((new Date(c.expiry) - today) / (1000 * 60 * 60 * 24));
            if (diffDays <= 30) alerts++;
        });
        document.getElementById('compliance-alerts-count').textContent = alerts;
    }

    function renderLTS(projects, tableId = 'lts-table-body') {
        const tableBody = document.getElementById(tableId);
        if (!tableBody) return;
        tableBody.innerHTML = '';
        projects.forEach(p => {
            let statusClass = '', statusDotClass = '';
            switch (p.status) {
                case 'On Track': statusClass = 'text-green-800 bg-green-100'; statusDotClass = 'bg-green-500'; break;
                case 'Delayed': statusClass = 'text-red-800 bg-red-100'; statusDotClass = 'bg-red-500'; break;
                case 'Completed': statusClass = 'text-gray-800 bg-gray-100'; statusDotClass = 'bg-gray-500'; break;
                case 'Planning': statusClass = 'text-blue-800 bg-blue-100'; statusDotClass = 'bg-blue-500'; break;
            }
            const row = `
                <tr class="bg-white border-b hover:bg-gray-50">
                    <td class="px-6 py-4 font-medium text-gray-900">${p.title}</td>
                    <td class="px-6 py-4">${p.pic}</td>
                    <td class="px-6 py-4">
                        <span class="px-2 py-1 font-semibold leading-tight rounded-full ${statusClass}">
                           <span class="status-dot ${statusDotClass}"></span> ${p.status}
                        </span>
                    </td>
                    ${tableId === 'lts-table-body' ? `<td class="px-6 py-4">${p.lastUpdate}</td>` : ''}
                </tr>`;
            tableBody.innerHTML += row;
        });
    }

    function renderCompliance(tableId = 'compliance-table-body') {
        const tableBody = document.getElementById(tableId);
        if (!tableBody) return;
        tableBody.innerHTML = '';
        const today = new Date();
        const sortedCompliance = [...mockData.compliance].sort((a, b) => new Date(a.expiry) - new Date(b.expiry));
        sortedCompliance.forEach(c => {
            const expiryDate = new Date(c.expiry);
            const diffDays = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));
            let statusText, statusClass;
            if (diffDays <= 0) { statusText = 'Expired'; statusClass = 'text-white bg-red-600'; } 
            else if (diffDays <= 30) { statusText = `Expires in ${diffDays} days`; statusClass = 'text-red-800 bg-red-100'; } 
            else if (diffDays <= 60) { statusText = `Expires in ${diffDays} days`; statusClass = 'text-yellow-800 bg-yellow-100'; } 
            else { statusText = 'Compliant'; statusClass = 'text-green-800 bg-green-100'; }
            const row = `
                 <tr class="bg-white border-b hover:bg-gray-50">
                    <td class="px-6 py-4 font-medium text-gray-900">${c.vessel}</td>
                    <td class="px-6 py-4">${c.certificate}</td>
                    ${tableId === 'compliance-table-body' ? `<td class="px-6 py-4">${c.expiry}</td>` : ''}
                    <td class="px-6 py-4">
                        <span class="px-2 py-1 font-semibold leading-tight rounded-full ${statusClass}">${statusText}</span>
                    </td>
                </tr>`;
            tableBody.innerHTML += row;
        });
    }

    function renderFinancialsChart() {
        const canvasElement = document.getElementById('financials-chart');
        if (!canvasElement) return;
        const ctx = canvasElement.getContext('2d');
        if (window.myFinancialsChart) {
            window.myFinancialsChart.destroy();
        }
        window.myFinancialsChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Revenue', 'Expenses', 'Net Surplus'],
                datasets: [{
                    label: 'Amount (PHP)',
                    data: [mockData.financials.revenue, mockData.financials.expenses, mockData.financials.netSurplus],
                    backgroundColor: ['rgba(16, 185, 129, 0.2)', 'rgba(239, 68, 68, 0.2)', 'rgba(59, 130, 246, 0.2)'],
                    borderColor: ['rgba(5, 150, 105, 1)', 'rgba(220, 38, 38, 1)', 'rgba(37, 99, 235, 1)'],
                    borderWidth: 1
                }]
            },
            options: {
                scales: { y: { beginAtZero: true, ticks: { callback: (v) => '₱' + new Intl.NumberFormat().format(v) } } },
                plugins: { legend: { display: false } }
            }
        });
    }
    
    function renderAuditLog() {
        const logContainer = document.getElementById('audit-log');
        if (!logContainer) return;
        logContainer.innerHTML = '';
        mockData.auditLog.forEach(log => {
            logContainer.innerHTML += `
                <li class="flex items-start">
                    <div class="flex-shrink-0 h-10 w-10 rounded-full bg-gray-100 flex items-center justify-center">
                       <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-900">${log.activity}</p>
                        <p class="text-sm text-gray-500">${log.finding}</p>
                        <p class="text-xs text-gray-400 mt-1">${log.date}</p>
                    </div>
                </li>`;
        });
    }

    function renderTopContributors() {
        const list = document.getElementById('top-contributors-list');
        list.innerHTML = '';
        const icons = ['🥇', '🥈', '🥉'];
        mockData.topContributors.forEach((c, index) => {
            list.innerHTML += `
                <li class="flex items-center">
                    <span class="text-2xl mr-4 w-8 text-center">${icons[index] || '•'}</span>
                    <div class="flex-1">
                        <p class="font-semibold text-gray-800">${c.name}</p>
                        <p class="text-sm text-gray-500">${c.vessel}</p>
                    </div>
                    <p class="font-bold text-emerald-600">₱${new Intl.NumberFormat().format(c.amount)}</p>
                </li>`;
        });
    }

    function renderLatestExpenses() {
        const list = document.getElementById('latest-expenses-list');
        list.innerHTML = '';
        mockData.latestExpenses.forEach(e => {
            list.innerHTML += `
                <li class="flex items-center border-b border-gray-100 pb-3">
                    <div class="flex-1">
                        <p class="font-medium text-gray-800">${e.item}</p>
                        <p class="text-xs text-gray-400">${e.date}</p>
                    </div>
                    <p class="font-semibold text-red-600">- ₱${new Intl.NumberFormat().format(e.amount)}</p>
                </li>`;
        });
    }

    function renderUpcomingEvents() {
        const list = document.getElementById('upcoming-events-list');
        list.innerHTML = '';
        mockData.upcomingEvents.forEach(e => {
            const eventDate = new Date(e.date);
            list.innerHTML += `
                <li class="flex items-center border-b border-gray-100 pb-3">
                    <div class="bg-blue-100 text-blue-800 font-bold rounded-lg p-3 text-center mr-4">
                        <p class="text-xs">${eventDate.toLocaleString('en-US', { month: 'short' })}</p>
                        <p class="text-xl">${eventDate.getDate()}</p>
                    </div>
                    <div class="flex-1">
                        <p class="font-medium text-gray-800">${e.event}</p>
                        <p class="text-sm text-gray-500">${e.time}</p>
                    </div>
                </li>`;
        });
    }

    function renderDigitalPaneTables() {
        renderLTS(mockData.ltsProjects.slice(0, 3), 'lts-table-body-digital');
        renderCompliance('compliance-table-body-digital');
    }

    // --- NAVIGATION LOGIC ---
    mainNav.addEventListener('click', (e) => {
        e.preventDefault();
        const targetLink = e.target.closest('.nav-link');
        if (!targetLink) return;

        mainNav.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
        targetLink.classList.add('active');

        const targetPaneId = targetLink.getAttribute('href').substring(1) + '-pane';
        contentPanes.forEach(pane => {
            pane.classList.toggle('active', pane.id === targetPaneId);
        });
        
        pageTitle.textContent = targetLink.textContent.trim();

        if (targetPaneId === 'finance-pane') {
            renderFinancialsChart();
            renderAuditLog();
        }
    });
    
    // --- LOGIN/LOGOUT LOGIC ---
    loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        profileName.textContent = document.getElementById('username').value.split('@')[0];
        loginPage.classList.add('hidden');
        mainApp.classList.remove('hidden');
        mainApp.classList.add('flex');
        renderAll();
    });

    logoutBtn.addEventListener('click', () => {
        mainApp.classList.add('hidden');
        mainApp.classList.remove('flex');
        loginPage.classList.remove('hidden');
        loginForm.reset();
        document.getElementById('username').value = 'chairperson@bangkeros.coop';
        document.getElementById('password').value = 'password';
    });
    
    // --- FORM MODAL LOGIC ---
    const formTemplates = {
        'form-pr': { title: 'Purchase & Requisition Form', templateId: 'template-form-pr' },
        'form-dv': { title: 'Disbursement Voucher', templateId: 'template-form-dv' },
        'form-ca': { title: 'Cash Advance Request', templateId: 'template-form-ca' },
        'form-lr': { title: 'Liquidation & Reimbursement Report', templateId: 'template-form-lr' },
        'form-cc': { title: 'Cash Count Sheet', templateId: 'template-form-cc' },
        'form-incident-report': { title: 'Incident Report / Complaint Form', templateId: 'template-form-incident-report' },
        'form-gad-plan': { title: 'GAD Plan & Budget', templateId: 'template-form-gad-plan' },
        'form-audit-plan': { title: 'Annual Audit Plan', templateId: 'template-form-audit-plan' },
        'form-coc': { title: 'Certificate of Candidacy', templateId: 'template-form-coc' },
        'form-election-protest': { title: 'Election Protest Form', templateId: 'template-form-election-protest' },
    };

    window.showFormModal = (formId) => {
        const formInfo = formTemplates[formId];
        if (!formInfo) return;
        const template = document.getElementById(formInfo.templateId);
        formModalTitle.textContent = formInfo.title;
        formModalBody.innerHTML = template.innerHTML;
        formModalSubmitBtn.dataset.formId = formId;
        formModal.classList.remove('hidden');
        formModal.classList.add('flex');
    };
    
    const closeFormModal = () => {
        formModal.classList.add('hidden');
        formModal.classList.remove('flex');
        formModalBody.innerHTML = '';
    };

    formModalCloseBtn.addEventListener('click', closeFormModal);
    formModalCancelBtn.addEventListener('click', closeFormModal);

    formModalSubmitBtn.addEventListener('click', () => {
        const formId = formModalSubmitBtn.dataset.formId;
        const form = formModalBody.querySelector('form');
        if (!form) return;
        
        const formData = new FormData(form);
        const reportData = Object.fromEntries(formData.entries());
        
        generateReport(formId, reportData);
        closeFormModal();
    });

    function generateReport(formId, data) {
        const formInfo = formTemplates[formId];
        let reportHtml = `<h3 class="text-xl font-bold mb-4">${formInfo.title} - Submitted Report</h3>`;
        reportHtml += `<p class="text-sm text-gray-500 mb-4">Submitted by: ${profileName.textContent} on ${new Date().toLocaleString()}</p>`;
        reportHtml += '<div class="space-y-2 text-sm">';
        for (const [key, value] of Object.entries(data)) {
            if (value) {
                const label = key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                reportHtml += `<div><strong class="text-gray-600">${label}:</strong> <span class="text-gray-800">${value}</span></div>`;
            }
        }
        reportHtml += '</div>';
        
        reportModalBody.innerHTML = reportHtml;
        reportModal.classList.remove('hidden');
        reportModal.classList.add('flex');
    }

    const closeReportModal = () => {
        reportModal.classList.add('hidden');
        reportModal.classList.remove('flex');
    };

    reportModalCloseBtn.addEventListener('click', closeReportModal);
    reportModalOkBtn.addEventListener('click', closeReportModal);


loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        profileName.textContent = document.getElementById('username').value.split('@')[0].replace(/\b\w/g, l => l.toUpperCase());
        loginPage.classList.add('hidden');
        mainApp.classList.remove('hidden');
        mainApp.classList.add('flex');
        mainNav.querySelector('a[href="#bod"]').click();
    });

    logoutBtn.addEventListener('click', () => {
        mainApp.classList.add('hidden');
        mainApp.classList.remove('flex');
        loginPage.classList.remove('hidden');
    });
    
    // --- BOD PANE LISTENERS ---
    bodAckCheckbox.addEventListener('change', () => {
        proceedToToolsBtn.disabled = !bodAckCheckbox.checked;
    });
    proceedToToolsBtn.addEventListener('click', () => {
        bodPolicyView.classList.add('hidden');
        bodGeneratorView.classList.remove('hidden');
        switchGeneratorMode('generator');
    });
    backToPoliciesBtn.addEventListener('click', () => {
        bodGeneratorView.classList.add('hidden');
        bodPolicyView.classList.remove('hidden');
    });

    // --- GENERATOR EVENT LISTENERS ---
    genModeBtn.addEventListener('click', () => switchGeneratorMode('generator'));
    meetingModeBtn.addEventListener('click', () => switchGeneratorMode('meeting'));
    proposalHelperBtn.addEventListener('click', () => switchGeneratorMode('proposal'));
    generateDocBtn.addEventListener('click', handleGenerateDocument);
    proposalForm.addEventListener('submit', handleProposalFormSubmit);
    docModalCloseBtn.addEventListener('click', () => docOutputModal.classList.add('hidden'));
    docOkBtn.addEventListener('click', () => docOutputModal.classList.add('hidden'));
    docCopyBtn.addEventListener('click', () => {
        const textToCopy = docOutputBody.querySelector('pre')?.innerText || docOutputBody.innerText;
        navigator.clipboard.writeText(textToCopy);
        alert('Document text copied to clipboard!');
    });
    meetingTranscript.addEventListener('input', handleMeetingTranscriptInput);

});
</script>

</body>
</html>
